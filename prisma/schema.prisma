// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  Int        @id @default(autoincrement())
  clerkId            String     @unique // Clerk user ID
  email              String     @unique
  username           String     @unique
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  profileId          Int?       @unique
  profile            Profile?   @relation(fields: [profileId], references: [id])
  bankCard           BankCard?
  donationsGiven     Donation[] @relation("DonorRelation")

  @@map("users")
}

model BankCard {
  id          Int      @id @default(autoincrement())
  country     String
  firstName   String
  lastName    String
  cardNumber  String
  expiryDate  String   // MM/YY format
  userId      Int      @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("bank_cards")
}

model Profile {
  id               Int        @id @default(autoincrement())
  name             String
  about            String?
  avatarImage      String?
  socialMediaURL   String?
  backgroundImage  String?
  successMessage   String?
  user             User?
  donationsReceived Donation[] @relation("RecipientRelation")
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

  @@map("profiles")
}

model Donation {
  id                      Int      @id @default(autoincrement())
  amount                  Int
  specialMessage          String?
  socialURLOrBuyMeACoffee String?
  donorId                 Int
  donor                   User     @relation("DonorRelation", fields: [donorId], references: [id])
  recipientId             Int
  recipient               Profile  @relation("RecipientRelation", fields: [recipientId], references: [id])
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@map("donations")
}